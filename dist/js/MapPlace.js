var MapPlace=function(e,a,o){var i=this;i.placeResult=e,console.log(i.placeResult),i.imageUrl="http://maps.googleapis.com/maps/api/streetview?size=560x200&location="+i.placeResult.geometry.location.lat()+","+i.placeResult.geometry.location.lng(),i.isWikiLoaded=ko.observable(!1),i.isWikiFailed=ko.observable(!1),i.wikiInformation=ko.observableArray([]),i.selectPlace=o,i.loadWikipediaData=function(){i.isWikiLoaded()||$.ajax("https://en.wikipedia.org/w/api.php?action=opensearch&search="+i.placeResult.name+"&prop=revisions&rvprop=content&format=json&callback=wikiCallback",{dataType:"jsonp",jsonp:"callback",success:function(e,a){if("success"===a&&e&&4===e.length&&e[1].length>0){for(var o=[],t=0,n=Math.min(e[1].length,5);n>t;t++)o.push({name:e[1][t],link:e[3][t],desc:e[2][t]});i.wikiInformation(o),0===o.length&&i.isWikiFailed(!0)}else i.isWikiFailed(!0)}}).fail(function(){i.isWikiFailed(!0)}).always(function(){i.isWikiLoaded(!0)})},i.isNYTimesLoaded=ko.observable(!1),i.isNYTimesFailed=ko.observable(!1),i.nytInformation=ko.observableArray([]),i.loadNYTimesData=function(){if(!i.isNYTimesLoaded()){var e="http://api.nytimes.com/svc/search/v2/articlesearch.json?q="+i.placeResult.name+"&api-key=6cbb4b8bb025f0865f9afc276c97f269:8:72368218";$.getJSON(e,function(e,a){if("success"===a&&e&&e.response.docs){for(var o=e.response.docs,t=[],n=0,s=Math.min(o.length,5);s>n;n++){var l=o[n];t.push({name:l.headline.main,link:l.web_url,desc:l.snippet})}i.nytInformation(t),0===t.length&&i.isNYTimesFailed(!0)}else i.isNYTimesFailed(!0)}).fail(function(){i.isNYTimesFailed(!0)}).always(function(){i.isNYTimesLoaded(!0)})}},i.isGoogleDataLoaded=ko.observable(!1),i.googleData=ko.observable(null),i.checkIfObjectHasProperty=function(e,a){e.hasOwnProperty(a)||(e[a]=null)},i.loadGoogleData=function(e){!i.isGoogleDataLoaded()&&i.placeResult.place_id&&e.getDetails({placeId:i.placeResult.place_id},function(e){if(i.checkIfObjectHasProperty(e,"formatted_phone_number"),i.checkIfObjectHasProperty(e,"website"),i.checkIfObjectHasProperty(e,"reviews"),e.reviews)for(var a=0,o=e.reviews.length;o>a;a++)i.checkIfObjectHasProperty(e.reviews[a],"author_url");i.googleData(e)})},i.createMarker=function(e,a){var o={url:i.placeResult.icon,scaledSize:new google.maps.Size(36,36),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,36)},t={coords:[1,1,1,36,36,36,36,1],type:"poly"};i.marker=new google.maps.Marker({position:i.getLocation(),map:e,icon:o,shape:t}),i.marker.addListener("click",function(){a&&a(i),i.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){i.marker.setAnimation(google.maps.Animation.NONE)},2500)})},i.createInfoWindow=function(){var e=i.getInfoWindowText(),o=new google.maps.InfoWindow({content:e});i.selectPlace(i,o),o.open(a,i.marker)},i.createMarker(a,i.createInfoWindow),i.userData=new UserData(i.placeResult.place_id)};MapPlace.prototype.getInfoWindowText=function(){return"<div data-toggle='modal' data-target='#myModal'><h4>"+this.placeResult.name+"</h4><p>"+this.placeResult.vicinity+"</p></div>"},MapPlace.prototype.getLocation=function(){var e=this.placeResult.geometry.location;return new google.maps.LatLng(e.lat(),e.lng())},MapPlace.prototype.animateMarker=function(){null!=this.marker&&this.marker.setAnimation(google.maps.Animation.BOUNCE)},MapPlace.prototype.stopAnimation=function(){null!=this.marker&&this.marker.setAnimation(google.maps.Animation.NONE)},MapPlace.prototype.removeMarker=function(){this.marker&&(this.marker.setMap(null),this.marker=null)},MapPlace.prototype.doesMatchFilter=function(e){if(e){if(0==e.length)return!0;var a=e.toUpperCase();return-1!=this.placeResult.name.toUpperCase().indexOf(a)||-1!=this.placeResult.vicinity.toUpperCase().indexOf(a)}return!0};