function initialize(){ko.applyBindings(new MapViewModel);var e=function(){$("#side-panel").slideToggle(),$("#side-panel-open-btn").hide()};$("#open-list-btn").click(e),$(".navbar-brand").click(e)}var MapViewModel=function(){var e=this;e.placesArray=[],e.placesFilteredArray=ko.observableArray([]),e.currentPlace=ko.observable(null),e.searchTerm=ko.observable(""),e.mapOptions=new MapOptions,e.isLoading=ko.observable(!0),e.isEmpty=ko.observable(!1),e.isError=ko.observable(!1),e.initializeMap=function(){var a=[{elementType:"labels.icon",stylers:[{visibility:"off"}]}],o=new google.maps.StyledMapType(a,{name:"Styled Map"});e.map=new google.maps.Map(document.getElementById("map"),{center:e.mapOptions.getLocation(),zoom:17}),e.map.mapTypes.set("map_style",o),e.map.setMapTypeId("map_style")},e.openInfoWindow=null,e.initializeMap(),e.placesService=new google.maps.places.PlacesService(e.map),e.setUpInfoWindow=function(a,o){null!=e.openInfoWindow&&e.openInfoWindow.close(),e.selectPlace(a),e.openInfoWindow=o},e.placeServiceCallback=function(a,o){if(o==google.maps.places.PlacesServiceStatus.OK){e.resetMarkers(),e.placesArray=[],e.placesFilteredArray.removeAll();for(var l=0,r=a.length;r>l;l++)e.placesArray.push(new MapPlace(a[l],e.map,e.setUpInfoWindow));e.placesFilteredArray(e.placesArray),e.isEmpty(!1),e.isError(!1),e.isLoading(!1)}else o==google.maps.places.PlacesServiceStatus.ZERO_RESULTS?(e.isLoading(!1),e.isError(!1),e.isEmpty(!0)):(e.isLoading(!1),e.isError(!0),e.isEmpty(!1))},e.resetMarkers=function(){for(var a=0,o=e.placesArray.length;o>a;a++)e.placesArray[a].removeMarker()},e.openModal=function(a){e.selectPlace(a),$("#myModal").modal("show")},e.updatePlaces=function(){e.isLoading(!0),e.resetMarkers();var a=e.mapOptions.getOptionsObject();e.placesService.nearbySearch(a,e.placeServiceCallback),e.mapOptions.updateLocalStorage()},e.selectPlace=function(a){e.currentPlace(a),a.loadWikipediaData(),a.loadNYTimesData(),a.loadGoogleData(e.placesService)},e.filterPlaces=function(){var a=e.searchTerm(),o=[];e.resetMarkers();for(var l=0,r=e.placesArray.length;r>l;l++)e.placesArray[l]&&e.placesArray[l].doesMatchFilter(a)&&(o.push(e.placesArray[l]),e.placesArray[l].createMarker(e.map,e.openModal));e.placesFilteredArray(o)},e.updatePlaces(),e.geocoder=new google.maps.Geocoder,e.newAddress=ko.observable(""),e.partialAddressList=ko.observableArray([]),e.updateAddress=function(){var a=e.newAddress();a&&a.length>0?e.geocoder.geocode({address:a},e.geocodeCallback):alert("Please enter a valid address")},e.geocodeCallback=function(a,o){if(o==google.maps.GeocoderStatus.OK)if(1==a.length){var l=a[0].geometry.location.lat(),r=a[0].geometry.location.lng();e.map.setCenter(a[0].geometry.location),e.mapOptions.setLocation(l,r),e.updatePlaces()}else 0==a.length?alert("No locations found matching that address"):(e.partialAddressList(a),$("#locationsPickerModal").modal("show"));else alert("Unable to contact Google Services")},e.selectNewAddress=function(a){e.mapOptions.setLocation(a.geometry.location.lat(),a.geometry.location.lng()),e.map.setCenter(a.geometry.location),e.updatePlaces(),$("#locationsPickerModal").modal("hide")}};